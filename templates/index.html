<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ settings.software_name }}</title>
  <link href="/static/css/tailwind.css" rel="stylesheet">
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 text-gray-900">
  <nav class="bg-gray-800 p-4">
    <div class="container mx-auto flex justify-between items-center">
      <a class="text-white text-lg font-bold" href="/">{{ settings.software_name }}</a>
      <div class="flex space-x-4">
        <a class="text-gray-300 hover:text-white" href="/">Accueil</a>
        <a class="text-gray-300 hover:text-white" href="#" data-toggle="modal" data-target="#aboutModal">À propos</a>
        <a class="text-gray-300 hover:text-white" href="#" data-toggle="modal" data-target="#contactModal">Contact</a>
      </div>
    </div>
  </nav>

  <div class="container mx-auto mt-8">
    <h1 class="text-3xl text-center font-bold">{{ settings.title_send_message }}</h1>
    <form class="mt-6 bg-white p-6 rounded-lg shadow-md" action="/send" method="post">
      <div class="mb-4">
        <label for="message" class="block text-gray-700">Message :</label>
        <textarea id="message" name="message" class="w-full p-2 border border-gray-300 rounded-md" rows="4" required></textarea>
      </div>
      <div class="mb-4">
        <label for="expiry" class="block text-gray-700">Durée de validité :</label>
        <select id="expiry" name="expiry" class="w-full p-2 border border-gray-300 rounded-md" required>
          <option value="3h">3 heures</option>
          <option value="1d">1 jour</option>
          <option value="1w">1 semaine</option>
          <option value="1m">1 mois</option>
        </select>
      </div>
      {% if settings.show_delete_on_read %}
      <div class="mb-4">
        <input type="checkbox" id="delete_on_read" name="delete_on_read">
        <label for="delete_on_read" class="text-gray-700">Supprimer après lecture</label>
      </div>
      {% endif %}
      {% if settings.show_password_protect %}
      <div class="mb-4">
        <input type="checkbox" id="password_protect" name="password_protect">
        <label for="password_protect" class="text-gray-700">Protéger par mot de passe</label>
        <input type="password" id="password" name="password" class="w-full p-2 border border-gray-300 rounded-md mt-2" placeholder="Entrez un mot de passe">
      </div>
      {% endif %}
      <div class="text-center">
        <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600">Envoyer</button>
      </div>
    </form>

    <!-- Modale pour afficher le lien -->
    <div class="modal fade" id="linkModal" tabindex="-1" role="dialog" aria-labelledby="linkModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="linkModalLabel">Lien de votre message</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <p>Votre message a été créé avec succès. Utilisez le lien ci-dessous pour accéder à votre message :</p>
            <input type="text" class="form-control" id="messageLink" value="{{ message_link }}" readonly>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" onclick="copyToClipboard()">Copier le lien</button>
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Fermer</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal À propos -->
  <div class="modal fade" id="aboutModal" tabindex="-1" role="dialog" aria-labelledby="aboutModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="aboutModalLabel">À propos</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          Le but de ce site est de permettre l'envoi sécurisé de messages sensibles. Chaque message est protégé par un lien unique, et peut être configuré pour être supprimé après lecture ou après une certaine durée.
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Fermer</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Contact -->
  <div class="modal fade" id="contactModal" tabindex="-1" role="dialog" aria-labelledby="contactModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="contactModalLabel">Contact</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          Pour toute question ou assistance, veuillez nous contacter à : <a href="mailto:{{ settings.contact_email }}">{{ settings.contact_email }}</a>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Fermer</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script>
      // Fonction pour copier le lien dans le presse-papier
      function copyToClipboard() {
          var copyText = document.getElementById("messageLink");
          copyText.select();
          document.execCommand("copy");
          alert("Lien copié dans le presse-papier");
      }

      // Ouvrir automatiquement le modale si un lien est généré
      {% if message_link %}
          $(document).ready(function() {
              $('#linkModal').modal('show');
          });
      {% endif %}
  </script>
</body>
</html>
