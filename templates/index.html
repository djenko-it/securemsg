<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ settings.software_name }}</title>
  <link href="/static/css/tailwind.css" rel="stylesheet">
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 text-gray-900">
  <nav class="bg-gray-800 p-4">
    <div class="container mx-auto flex justify-between items-center">
      <a class="text-white text-lg font-bold" href="/">{{ settings.software_name }}</a>
      <div class="flex space-x-4">
        <a class="text-gray-300 hover:text-white" href="/">Accueil</a>
        <a class="text-gray-300 hover:text-white" href="#" data-toggle="modal" data-target="#aboutModal">À propos</a>
        <a class="text-gray-300 hover:text-white" href="#" data-toggle="modal" data-target="#contactModal">Contact</a>
      </div>
    </div>
  </nav>

  <div class="container mx-auto mt-8">
    <h1 class="text-3xl text-center font-bold">{{ settings.title_send_message }}</h1>
    <form class="mt-6 bg-white p-6 rounded-lg shadow-md" action="/send" method="post">
      <div class="mb-4">
        <label for="message" class="block text-gray-700">Message :</label>
        <textarea id="message" name="message" class="w-full p-2 border border-gray-300 rounded-md" rows="4" required></textarea>
      </div>
      <div class="mb-4">
        <label for="expiry" class="block text-gray-700">Durée de validité :</label>
        <select id="expiry" name="expiry" class="w-full p-2 border border-gray-300 rounded-md" required>
          <option value="3h">3 heures</option>
          <option value="1d">1 jour</option>
          <option value="1w">1 semaine</option>
          <option value="1m">1 mois</option>
        </select>
      </div>
      {% if settings.show_delete_on_read %}
      <div class="mb-4">
        <input type="checkbox" id="delete_on_read" name="delete_on_read">
        <label for="delete_on_read" class="text-gray-700">Supprimer après lecture</label>
      </div>
      {% endif %}
      {% if settings.show_password_protect %}
      <div class="mb-4">
        <input type="checkbox" id="password_protect" name="password_protect">
        <label for="password_protect" class="text-gray-700">Protéger par mot de passe</label>
        <input type="password" id="password" name="password" class="w-full p-2 border border-gray-300 rounded-md mt-2" placeholder="Entrez un mot de passe">
      </div>
      {% endif %}
      <div class="text-center">
        <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600">Envoyer</button>
      </div>
    </form>
    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <div class="mt-4">
          {% for message in messages %}
            <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative" role="alert">
              {{ message }}
              <button class="btn btn-primary" onclick="copyToClipboard('{{ message }}')">Copier le lien</button>
            </div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}
  </div>

  <!-- Modal À propos -->
  <div class="modal fade" id="aboutModal" tabindex="-1" role="dialog" aria-labelledby="aboutModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="aboutModalLabel">À propos</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          Le but de ce site est de permettre l'envoi sécurisé de messages sensibles. Chaque message est protégé par un lien unique, et peut être configuré pour être supprimé après lecture ou après une certaine durée.
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Fermer</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Contact -->
  <div class="modal fade" id="contactModal" tabindex="-1" role="dialog" aria-labelledby="contactModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="contactModalLabel">Contact</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          Pour toute question ou assistance, veuillez nous contacter à : <a href="mailto:{{ settings.contact_email }}">{{ settings.contact_email }}</a>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Fermer</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script>
    function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(function() {
        alert('Lien copié dans le presse-papier');
      }, function(err) {
        alert('Erreur lors de la copie du lien');
      });
    }
  </script>
</body>
</html>