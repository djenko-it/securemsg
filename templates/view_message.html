<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Message Sécurisé</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            padding-top: 70px;
            background-color: #f8f9fa;
            font-family: 'Arial', sans-serif;
        }
        .container {
            max-width: 600px;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        .navbar {
            background-color: #e3e3e3b3;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .navbar-brand {
            color: black;
            font-weight: bold;
        }
        .nav-link {
            color: black;
            transition: color 0.3s;
        }
        .nav-link:hover {
            color: #007bff;
        }
        .message-box {
            background-color: #d4edda; /* Vert clair */
            border-color: #c3e6cb; /* Bordure vert clair */
            color: #155724; /* Texte vert foncé */
            padding: 20px;
            border-radius: 5px;
            margin-top: 20px;
        }
        .alert-info {
            background-color: #e9f7ff;
            border-color: #b6effb;
            color: #31708f;
        }
        .alert-danger {
            background-color: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        .form-check-label {
            margin-left: 10px;
        }
        button, .btn-primary {
            background-color: #007bff;
            border: none;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        button:hover, .btn-primary:hover {
            background-color: #0056b3;
            color: #ffffff;
        }
        .btn-copied {
            background-color: #28a745;
            color: white;
        }
        .modal-content {
            border-radius: 10px;
        }
        .modal-header {
            background-color: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }
        .modal-title {
            font-weight: bold;
        }
        .modal-footer {
            border-top: 1px solid #dee2e6;
        }
        .modal-body a {
            color: #007bff;
            text-decoration: none;
        }
        .modal-body a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg fixed-top">
        <a class="navbar-brand" href="/">SecureMsg</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <a class="nav-link home-link" href="/">Accueil</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" data-toggle="modal" data-target="#aboutModal">À propos</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" data-toggle="modal" data-target="#contactModal">Contact</a>
                </li>
            </ul>
        </div>
    </nav>
    
    <div class="container">
        {% if message %}
            <h1 class="text-center">Votre Message</h1>
            <div class="message-box mt-4">{{ message }}</div>
            {% if delete_on_read %}
                <p class="text-center text-muted mt-3">Ce message est unique et ne sera plus accessible une fois cette page fermée.</p>
            {% else %}
                <p class="text-center text-muted mt-3">Durée de validité : <span id="time-remaining"></span></p>
            {% endif %}
        {% elif error %}
            <h1 class="text-center">Erreur</h1>
            <div class="alert alert-danger mt-4">{{ error }}</div>
        {% endif %}
    </div>
    
    <!-- Modal À propos -->
    <div class="modal fade" id="aboutModal" tabindex="-1" role="dialog" aria-labelledby="aboutModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="aboutModalLabel">À propos</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            Le but de ce site est de permettre l'envoi sécurisé de messages sensibles. Chaque message est protégé par un lien unique, et peut être configuré pour être supprimé après lecture ou après une certaine durée.
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Fermer</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Contact -->
    <div class="modal fade" id="contactModal" tabindex="-1" role="dialog" aria-labelledby="contactModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="contactModalLabel">Contact</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            Pour toute question ou assistance, veuillez nous contacter à : <a href="mailto:djneko-it@protonmail.com">djneko-it@protonmail.com</a>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Fermer</button>
          </div>
        </div>
      </div>
    </div>
    
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', (event) => {
            const expiryTime = new Date('{{ expiry }}').getTime();
            const timeRemainingElement = document.getElementById('time-remaining');

            function updateTimeRemaining() {
                const now = new Date().getTime();
                const timeRemaining = expiryTime - now;

                if (timeRemaining <= 0) {
                    timeRemainingElement.innerHTML = 'Le message a expiré.';
                } else {
                    const days = Math.floor(timeRemaining / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((timeRemaining % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((timeRemaining % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((timeRemaining % (1000 * 60)) / 1000);

                    let timeString = "";
                    if (days > 0) {
                        timeString += `${days} jours `;
                    }
                    timeString += `${hours} heures ${minutes} minutes ${seconds} secondes`;

                    timeRemainingElement.innerHTML = timeString;

                    setTimeout(updateTimeRemaining, 1000);
                }
            }

            updateTimeRemaining();

            if ({{ delete_on_read|tojson }}) {
                window.addEventListener('beforeunload', function (e) {
                    const confirmationMessage = 'Ce message est unique et ne sera plus accessible une fois cette page fermée.';
                    (e || window.event).returnValue = confirmationMessage; // Gecko + IE
                    return confirmationMessage; // Webkit, Safari, Chrome etc.
                });

                document.querySelectorAll('.home-link').forEach(link => {
                    link.addEventListener('click', function (event) {
                        const confirmationMessage = 'Ce message est unique et ne sera plus accessible une fois cette page fermée. Voulez-vous continuer ?';
                        if (!confirm(confirmationMessage)) {
                            event.preventDefault();
                        }
                    });
                });
            }
        });
    </script>
</body>
</html>
